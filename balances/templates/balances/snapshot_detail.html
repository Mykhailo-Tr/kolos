{% extends "base.html" %}
{% load humanize %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/journal.css' %}">

<div class="journal-container">
  <div class="page-header">
    <div>
      <h1 class="page-title">üìä {{ model_name }}</h1>
      <p class="text-muted mb-0" style="font-size: 0.95rem;">
        <strong>–î–∞—Ç–∞:</strong> {{ snapshot.snapshot_date|date:"d.m.Y H:i" }} | 
        <strong>–û–ø–∏—Å:</strong> {{ snapshot.description|default:"‚Äî" }} | 
        <strong>–°—Ç–≤–æ—Ä–µ–Ω–æ:</strong> {{ snapshot.created_by }}
      </p>
    </div>
    <div style="display: flex; gap: 0.75rem;">
      <a href="{% url 'balance_snapshot_update' snapshot.pk %}" class="btn-add" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
        <span>‚úèÔ∏è</span>
        <span>–†–µ–¥–∞–≥—É–≤–∞—Ç–∏</span>
      </a>
      <a href="{% url 'balance_snapshot_list' %}" class="btn-add" style="background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);">
        <span>‚Ü©Ô∏è</span>
        <span>–î–æ —ñ—Å—Ç–æ—Ä—ñ—ó</span>
      </a>
    </div>
  </div>

  <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
  <div class="row mb-4">
    <div class="col-md-4">
      <div class="card border-primary">
        <div class="card-body text-center">
          <h5 class="card-title text-primary">üì¶ –í—Å—å–æ–≥–æ –∑–∞–ø–∏—Å—ñ–≤</h5>
          <h2 class="mb-0">{{ snapshot.total_records }}</h2>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card border-success">
        <div class="card-body text-center">
          <h5 class="card-title text-success">‚öñÔ∏è –ó–∞–≥–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å</h5>
          <h2 class="mb-0">{{ snapshot.total_quantity|floatformat:3 }} —Ç</h2>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card border-info">
        <div class="card-body text-center">
          <h5 class="card-title text-info">üïí –î–∞—Ç–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è</h5>
          <h2 class="mb-0" style="font-size: 1.3rem;">{{ snapshot.snapshot_date|date:"d.m.Y" }}</h2>
          <small class="text-muted">{{ snapshot.snapshot_date|date:"H:i" }}</small>
        </div>
      </div>
    </div>
  </div>

  {% if history_records %}
    <div class="table-wrapper">
      <table class="journal-table">
        <thead>
          <tr>
            <th>#</th>
            <th>–ú—ñ—Å—Ü–µ –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è</th>
            <th>–ö—É–ª—å—Ç—É—Ä–∞</th>
            <th>–¢–∏–ø –±–∞–ª–∞–Ω—Å—É</th>
            <th>–ö—ñ–ª—å–∫—ñ—Å—Ç—å (—Ç–æ–Ω–Ω)</th>
          </tr>
        </thead>
        <tbody>
          {% for record in history_records %}
          <tr>
            <td class="text-center">{{ forloop.counter }}</td>
            <td>{{ record.place_name }}</td>
            <td>{{ record.culture_name }}</td>
            <td>
              {% if record.balance_type == 'stock' %}
                <span class="badge bg-success">–ó–µ—Ä–Ω–æ</span>
              {% else %}
                <span class="badge bg-warning">–í—ñ–¥—Ö–æ–¥–∏</span>
              {% endif %}
            </td>
            <td class="text-end">
              <span class="quantity-value">{{ record.quantity|floatformat:3 }}</span>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- –ü–∞–≥—ñ–Ω–∞—Ü—ñ—è -->
    {% if is_paginated %}
    <nav aria-label="–ù–∞–≤—ñ–≥–∞—Ü—ñ—è –ø–æ —Å—Ç–æ—Ä—ñ–Ω–∫–∞—Ö" class="mt-4">
      <ul class="pagination justify-content-center">
        {% if page_obj.has_previous %}
          <li class="page-item">
            <a class="page-link" href="?page=1">–ü–µ—Ä—à–∞</a>
          </li>
          <li class="page-item">
            <a class="page-link" href="?page={{ page_obj.previous_page_number }}">–ü–æ–ø–µ—Ä–µ–¥–Ω—è</a>
          </li>
        {% endif %}

        <li class="page-item active">
          <span class="page-link">–°—Ç–æ—Ä—ñ–Ω–∫–∞ {{ page_obj.number }} –∑ {{ page_obj.paginator.num_pages }}</span>
        </li>

        {% if page_obj.has_next %}
          <li class="page-item">
            <a class="page-link" href="?page={{ page_obj.next_page_number }}">–ù–∞—Å—Ç—É–ø–Ω–∞</a>
          </li>
          <li class="page-item">
            <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}">–û—Å—Ç–∞–Ω–Ω—è</a>
          </li>
        {% endif %}
      </ul>
    </nav>
    {% endif %}
  {% else %}
    <div class="alert-info">–£ —Ü—å–æ–º—É –∑–ª—ñ–ø–∫—É –Ω–µ–º–∞—î –∑–∞–ø–∏—Å—ñ–≤.</div>
  {% endif %}
</div>

{% endblock %}