{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
  <h3 class="mb-3">
    {% if view.object %}
      ‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è: {{ view.object }}
    {% else %}
      ‚ûï –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É
    {% endif %}
  </h3>

  <form method="post" novalidate>
    {% csrf_token %}
    
    {% if form.non_field_errors %}
      <div class="alert alert-danger">
        {% for error in form.non_field_errors %}
          <div>{{ error }}</div>
        {% endfor %}
      </div>
    {% endif %}
    
    <div class="row g-3">
      {% for field in form.visible_fields %}
        {% if field.name == 'action_type' or field.name == 'note' %}
          <div class="col-md-12">
        {% else %}
          <div class="col-md-6">
        {% endif %}
            <div class="mb-3">
              <label for="{{ field.id_for_label }}" class="form-label fw-semibold">
                {{ field.label }}{% if field.field.required %}<span class="text-danger">*</span>{% endif %}
              </label>
              {{ field }}
              {% if field.help_text %}
                <div class="form-text">{{ field.help_text }}</div>
              {% endif %}
              {% for error in field.errors %}
                <div class="text-danger small">{{ error }}</div>
              {% endfor %}
            </div>
          </div>
        
        {% if field.name == 'weight_loss' %}
          <div class="col-md-6">
            <div class="mb-3">
              <label class="form-label fw-semibold">–í–∞–≥–∞ –Ω–µ—Ç—Ç–æ (—Ç—ñ–ª—å–∫–∏ –ø–µ—Ä–µ–≥–ª—è–¥)</label>
              <input
                type="number"
                id="weight-net-display"
                class="form-control"
                step="0.001"
                readonly
              >
              <div class="form-text">–†–æ–∑—Ä–∞—Ö–æ–≤—É—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ</div>
            </div>
          </div>
        {% endif %}
      {% endfor %}
    </div>
    
    <div class="mt-4 d-flex gap-2">
      <button type="submit" class="btn btn-primary">
        üíæ –ó–±–µ—Ä–µ–≥—Ç–∏
      </button>
      <a href="{% url url_name|add:'_list' %}" class="btn btn-secondary">
        ‚¨Ö –ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è –¥–æ —Å–ø–∏—Å–∫—É
      </a>
    </div>
  </form>
</div>

<!-- –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è Select2 -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>

<script>
$(document).ready(function() {
    // –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –≤–∞–≥–∏ –Ω–µ—Ç—Ç–æ
    function calculateNet() {
        const gross = parseFloat($('#id_weight_gross').val()) || 0;
        const tare = parseFloat($('#id_weight_tare').val()) || 0;
        const loss = parseFloat($('#id_weight_loss').val()) || 0;
        const net = gross - tare - loss;
        $('#weight-net-display').val(net.toFixed(3));
    }

    $('#id_weight_gross, #id_weight_tare, #id_weight_loss').on('input', calculateNet);
    calculateNet();

    // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è Select2 –¥–ª—è –≤—Å—ñ—Ö select –ø–æ–ª—ñ–≤
    $('select').select2({
        width: '100%',
        language: 'uk',
        placeholder: '–û–±–µ—Ä—ñ—Ç—å –∑–Ω–∞—á–µ–Ω–Ω—è...',
        allowClear: true
    });
});
</script>
{% endblock %}