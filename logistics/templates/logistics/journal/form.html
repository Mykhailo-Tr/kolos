{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
  <h3 class="mb-3">
    {% if view.object %}
      ‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è: {{ view.object }}
    {% else %}
      ‚ûï –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É
    {% endif %}
  </h3>

  <form method="post" novalidate>
    {% csrf_token %}
    
    {% if form.non_field_errors %}
      <div class="alert alert-danger">
        {% for error in form.non_field_errors %}
          <div>{{ error }}</div>
        {% endfor %}
      </div>
    {% endif %}
    
<div class="row g-3">
  {% with total=form.visible_fields|length %}
    {% for field in form.visible_fields %}
      {% if field.name == 'action_type' %}
        <div class="col-md-12">
      {% elif field.name == 'note'%}
        <div class="col-md-12">
      {% else %}
        <div class="col-md-6">
      {% endif %}
          <div class="mb-3">
            <label for="{{ field.id_for_label }}" class="form-label fw-semibold">
              {{ field.label }}{% if field.field.required %}<span class="text-danger">*</span>{% endif %}
            </label>
            {{ field }}
            {% if field.help_text %}
              <div class="form-text">{{ field.help_text }}</div>
            {% endif %}
            {% for error in field.errors %}
              <div class="text-danger small">{{ error }}</div>
            {% endfor %}
          </div>
        </div>
      {% if field.name == 'weight_loss' %}
        <div class="col-md-6">
          <div class="mb-3">
            <label class="form-label fw-semibold">–í–∞–≥–∞ –Ω–µ—Ç—Ç–æ (—Ç—ñ–ª—å–∫–∏ –ø–µ—Ä–µ–≥–ª—è–¥)</label>
            <input
              type="number"
              id="weight-net-display"
              class="form-control"
              step="0.001"
              readonly
            >
            <div class="form-text">–†–æ–∑—Ä–∞—Ö–æ–≤—É—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ</div>
          </div>
        </div>
      {% endif %}
    {% endfor %}
  {% endwith %}

</div>
    <div class="mt-4 d-flex gap-2">
      <button type="submit" class="btn btn-primary">
        üíæ –ó–±–µ—Ä–µ–≥—Ç–∏
      </button>
      <a href="{% url url_name|add:'_list' %}" class="btn btn-secondary">
        ‚¨Ö –ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è –¥–æ —Å–ø–∏—Å–∫—É
      </a>
    </div>
  </form>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const grossInput = document.getElementById("id_weight_gross");
    const tareInput = document.getElementById("id_weight_tare");
    const lossInput = document.getElementById("id_weight_loss");
    const netDisplay = document.getElementById("weight-net-display");

    const calculateNet = () => {
        const gross = parseFloat(grossInput.value) || 0;
        const tare = parseFloat(tareInput.value) || 0;
        const loss = parseFloat(lossInput.value) || 0;
        const net = gross - tare - loss;
        netDisplay.value = net.toFixed(3);
    };

    [grossInput, tareInput, lossInput].forEach(input => {
        input.addEventListener("input", calculateNet);
    });

    calculateNet(); // –ø–æ—á–∞—Ç–∫–æ–≤–∏–π —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫
});
</script>

{% endblock %}
